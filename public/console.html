<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HJS ¬∑ Developer Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=JetBrains+Mono:wght@400;500;600&display=swap');
        * { font-family: 'Inter', system-ui, sans-serif; }
        .font-mono, code, pre { font-family: 'JetBrains Mono', monospace !important; }
        body { background: #0a0a0a; color: #e5e5e5; min-height: 100vh; }
        html { scroll-behavior: smooth; }
        .text-steel { color: #3B4B5C; }
        .border-steel { border-color: #3B4B5C; }
        .bg-steel\/10 { background-color: rgba(59, 75, 92, 0.1); }
        .bg-steel\/20 { background-color: rgba(59, 75, 92, 0.2); }
        .hover\:bg-steel\/20:hover { background-color: rgba(59, 75, 92, 0.2); }
        .bg-card { background: rgba(26, 26, 26, 0.5); }
        .border-border { border-color: #1f1f1f; }
        .text-muted-foreground { color: #9ca3af; }
        .key-value { word-break: break-all; max-width: 100%; display: inline-block; }
        .text-foreground { color: #e5e5e5; }
        .bg-background { background: #0a0a0a; }
        .hover\:border-steel:hover { border-color: #3B4B5C; }
        .hover\:text-foreground:hover { color: #e5e5e5; }
        .disabled\:opacity-60:disabled { opacity: 0.6; }
        .disabled\:cursor-not-allowed:disabled { cursor: not-allowed; }
        .focus\:border-steel:focus { border-color: #3B4B5C; }
        
        /* Ê†áÁ≠æÈ°µÊ†∑Âºè */
        .tab-button {
            padding: 0.5rem 0;
            font-size: 0.875rem;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }
        .tab-button.active {
            color: white;
            border-bottom-color: #3B4B5C;
        }
        .tab-button:not(.active) {
            color: #9ca3af;
        }
        .tab-button:not(.active):hover {
            color: #e5e5e5;
        }
        
        /* Êó•ÂøóÊªöÂä® */
        .log-container {
            max-height: 200px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #3B4B5C #1f1f1f;
        }
        .log-container::-webkit-scrollbar {
            width: 6px;
        }
        .log-container::-webkit-scrollbar-track {
            background: #1f1f1f;
        }
        .log-container::-webkit-scrollbar-thumb {
            background-color: #3B4B5C;
            border-radius: 3px;
        }
        
        /* Áä∂ÊÄÅÈ¢úËâ≤ */
        .status-200 { color: #10b981; }
        .status-201 { color: #10b981; }
        .status-404 { color: #ef4444; }
        .status-500 { color: #f59e0b; }
        
        /* Âä®Áîª */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        /* ÂúÜËßí */
        .rounded { border-radius: 0.25rem; }
        /* Èò≤Ê≠¢È°µÈù¢Ë∑≥Âä® */n        html { overflow-y: scroll; }n        body { min-height: 100vh; display: flex; flex-direction: column; }
    </style>
</head>
<body>
    <div class="mx-auto max-w-4xl px-6 pt-12 pb-12">
        <!-- ===== ÂØºËà™Ê†è ===== -->
        <div class="flex justify-between items-center py-6 text-base">
            <div class="text-white font-semibold text-lg">HJS</div>
            <div class="flex gap-8 md:gap-10 text-gray-400">
                <a href="/" class="hover:text-teal-400 transition" data-i18n="nav_home">Home</a>
                <a href="/product.html" class="hover:text-teal-400 transition" data-i18n="nav_product">Product</a>
                <a href="/developers.html" class="hover:text-teal-400 transition" data-i18n="nav_developers">Developers</a>
                <a href="/console.html" class="text-white" data-i18n="nav_console">Console</a>
                <a href="/lookup.html" class="hover:text-teal-400 transition" data-i18n="nav_lookup">Lookup</a>
                <a href="/billing.html" class="hover:text-teal-400 transition" data-i18n="nav_billing">Billing</a>
                <a href="/roi-calculator.html" class="hover:text-teal-400 transition" data-i18n="nav_roi">ROI</a>
                <a href="/governance.html" class="hover:text-teal-400 transition" data-i18n="nav_governance">Governance</a>
            </div>
            <select onchange="switchLang(this.value)" class="bg-transparent text-gray-400 text-xs">
                <option value="en">EN</option>
                <option value="zh">‰∏≠Êñá</option>
            </select>
        </div>

        <!-- Header -->
        <section class="py-24">
            <p class="mb-4 font-mono text-xs text-gray-500" data-i18n="con_version_tag">
                HJS Responsibility Protocol ¬∑ v1.0 Beta
            </p>
            <h1 class="mt-6 text-3xl font-light leading-tight tracking-tight text-white md:text-4xl" data-i18n="con_title">
                Developer Console
            </h1>
            <p class="mt-4 max-w-xl text-sm leading-relaxed text-gray-400" data-i18n="con_subtitle">
                Manage API keys, inspect records, and monitor protocol usage.
            </p>
        </section>

        <!-- Email authentication -->
        <section class="mb-12 border border-gray-800 bg-card p-6" id="auth-section">
            <h2 class="font-mono text-xs uppercase tracking-widest text-gray-400" data-i18n="con_auth_heading">
                EMAIL AUTHENTICATION
            </h2>
            <div class="mt-4 flex gap-2">
                <input
                    type="email"
                    id="email-input"
                    placeholder="your@email.com"
                    class="flex-1 border border-gray-800 bg-background px-3 py-2 font-mono text-sm text-white placeholder:text-gray-500 outline-none transition-colors focus:border-steel disabled:opacity-60"
                />
                <button
                    id="verify-btn"
                    class="shrink-0 border border-steel bg-steel/10 px-5 py-2 text-xs font-medium text-white transition-colors hover:bg-steel/20 disabled:opacity-40 disabled:cursor-not-allowed"
                >
                    Verify
                </button>
                <button
                    id="logout-btn"
                    class="shrink-0 border border-gray-700 px-5 py-2 text-xs text-gray-400 transition-colors hover:text-white hidden"
                >
                    Logout
                </button>
            </div>
            <p id="auth-status" class="mt-3 font-mono text-xs text-gray-400 hidden">
                <span data-i18n="con_auth_current">Current</span>: <span id="current-email" class="text-white"></span>
                <span class="text-steel"> (<span data-i18n="con_auth_active">active</span>)</span>
            </p>
        </section>

        <!-- Ê†áÁ≠æÈ°µ -->
        <div class="border-b border-gray-800 mb-6">
            <div class="flex gap-6">
                <button class="tab-button active" id="tab-keys" data-tab="keys">
                    API Keys & Records
                </button>
                <button class="tab-button" id="tab-usage" data-tab="usage">
                    Usage & Billing
                </button>
            </div>
        </div>

        <!-- ===== Keys & Records Èù¢Êùø ===== -->
        <div id="panel-keys" class="panel">
            <section class="grid gap-6 pb-24 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
                <!-- Left: API Keys -->
                <div class="border border-gray-800 bg-card/50 p-5" id="api-keys-panel">
                    <h3 class="font-mono text-xs uppercase tracking-widest text-gray-400 mb-4" data-i18n="con_keys_heading">
                        API KEY MANAGEMENT
                    </h3>
                    
                    <!-- Create Key -->
                    <div class="mb-6">
                        <div class="flex gap-2">
                            <input
                                type="text"
                                id="key-name-input"
                                placeholder="Key name"
                                class="flex-1 border border-gray-800 bg-background px-3 py-2 text-sm text-white placeholder:text-gray-500 outline-none focus:border-steel disabled:opacity-60"
                                disabled
                            />
                            <button
                                id="generate-key-btn"
                                class="shrink-0 border border-steel bg-steel/10 px-4 py-2 text-xs text-white hover:bg-steel/20 disabled:opacity-40 disabled:cursor-not-allowed"
                                disabled
                                data-i18n="con_keys_generate"
                            >
                                Generate
                            </button>
                        </div>
                    </div>

                    <!-- Keys List -->
                    <div id="keys-list" class="space-y-3">
                        <div class="text-center text-gray-500 text-sm py-8" data-i18n="con_keys_verify_first">
                            Verify email to load keys
                        </div>
                    </div>
                </div>

                <!-- Middle: Record Lookup (Ë∑≥ËΩ¨Áâà) -->
                <div class="border border-gray-800 bg-card/50 p-5" id="record-lookup-panel">
                    <h3 class="font-mono text-xs uppercase tracking-widest text-gray-400 mb-4" data-i18n="con_lookup_heading">
                        RECORD LOOKUP
                    </h3>
                    
                    <div class="mb-4">
                        <div class="flex gap-2">
                            <input
                                type="text"
                                id="record-id-input"
                                placeholder="jgd_xxx"
                                class="flex-1 border border-gray-800 bg-background px-3 py-2 font-mono text-sm text-white placeholder:text-gray-500 outline-none focus:border-steel"
                            />
                            <button
                                id="lookup-btn"
                                class="shrink-0 border border-steel bg-steel/10 px-4 py-2 text-xs text-white hover:bg-steel/20"
                                data-i18n="con_lookup_button"
                            >
                                Lookup ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Example IDs -->
                    <div class="mt-4">
                        <p class="text-xs text-gray-500 mb-2" data-i18n="con_lookup_examples">Examples:</p>
                        <div class="flex flex-wrap gap-2">
                            <button class="example-id text-xs text-steel hover:text-white border border-gray-800 px-2 py-1 rounded" data-id="jgd_1771313790343osf2">jgd_1771...osf2</button>
                            <button class="example-id text-xs text-steel hover:text-white border border-gray-800 px-2 py-1 rounded" data-id="jgd_1771312310200pbtx">jgd_1771...pbtx</button>
                            <button class="example-id text-xs text-steel hover:text-white border border-gray-800 px-2 py-1 rounded" data-id="jgd_1771309413724aqeh">jgd_1771...aqeh</button>
                        </div>
                    </div>
                    
                    <div class="mt-4 border-t border-gray-800 pt-3">
                        <p class="text-xs text-gray-500">
                            ‚ö° <span data-i18n="con_lookup_note">Record verification moved to </span><a href="/lookup.html" class="text-steel hover:underline">Lookup page</a>.
                        </p>
                    </div>
                </div>

                <!-- Right: Quick Stats -->
                <div class="border border-gray-800 bg-card/50 p-5">
                    <h3 class="font-mono text-xs uppercase tracking-widest text-gray-400 mb-4" data-i18n="con_stats_heading">
                        QUICK STATS
                    </h3>
                    
                    <!-- Stats -->
                    <div id="quick-stats" class="space-y-3 mb-6">
                        <div class="text-center text-gray-500 text-sm py-4" data-i18n="con_stats_verify_first">
                            Verify email to load stats
                        </div>
                    </div>

                    <!-- Recent Logs -->
                    <h4 class="font-mono text-xs uppercase tracking-widest text-gray-400 mb-2" data-i18n="con_logs_heading">
                        RECENT REQUESTS
                    </h4>
                    <div id="logs-container" class="log-container border border-gray-800 bg-background p-3 font-mono text-xs space-y-1" style="max-height:200px; overflow-y:auto;">
                        <div class="text-center text-gray-500 py-2" data-i18n="con_logs_verify_first">
                            Verify email to load logs
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ===== Usage & Billing Èù¢ÊùøÔºàÂ≠òÂÇ®ÂÖçË¥πÁâàÔºâ ===== -->
        <div id="panel-usage" class="panel hidden">
            <section class="pb-24">
                <!-- Áî®ÈáèÊ¶ÇËßàÂç°Áâá -->
                <div class="border border-gray-800 bg-card/50 p-6 mb-6">
                    <h3 class="font-mono text-sm font-medium text-white mb-4">Usage Overview</h3>
                    
                    <!-- ‰ΩôÈ¢ùËøõÂ∫¶Êù°ÔºàÊîπ‰∏∫Êó†ÈôêÂ≠òÂÇ®Ôºâ -->
                    <div class="mb-6">
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-gray-400">Storage</span>
                            <span class="text-green-400 font-medium">FREE</span>
                            <span class="text-gray-500">unlimited</span>
                        </div>
                        <div class="w-full bg-gray-800 h-2 rounded-full overflow-hidden">
                            <div id="quota-bar" class="bg-steel h-2 rounded-full" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-xs mt-2">
                            <span class="text-gray-500">Used</span>
                            <span class="text-gray-500" id="quota-remaining">Unlimited storage</span>
                        </div>
                    </div>

                    <!-- ÈîöÂÆöÁî®Èáè -->
                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-400">Monthly Anchors</span>
                            <span class="text-white font-mono" id="monthly-anchors">0</span>
                        </div>
                        <p class="text-xs text-gray-500">$0.03 per anchor + network fee</p>
                    </div>

                    <!-- ËØ¶ÁªÜÁî®Èáè -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="border border-gray-800 p-4">
                            <p class="text-xs text-gray-500 mb-1">Total Records</p>
                            <p class="text-2xl font-mono text-white" id="total-judgments">0</p>
                        </div>
                        <div class="border border-gray-800 p-4">
                            <p class="text-xs text-gray-500 mb-1">Active Keys</p>
                            <p class="text-2xl font-mono text-white" id="active-keys">0</p>
                        </div>
                        <div class="border border-gray-800 p-4">
                            <p class="text-xs text-gray-500 mb-1">Est. Cost</p>
                            <p class="text-2xl font-mono text-white" id="monthly-cost">$0.00</p>
                        </div>
                    </div>

                    <!-- ‰ΩôÈ¢ù‰ø°ÊÅØ -->
                    <div class="border-t border-gray-800 pt-4 mb-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Current Balance</span>
                            <span class="text-white font-mono" id="balance-amount">$0.00</span>
                        </div>
                    </div>

                    <!-- ËÆ°Ë¥π‰ø°ÊÅØ -->
                    <div class="border-t border-gray-800 pt-4 mt-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-sm text-white">Billing</p>
                                <p class="text-xs text-gray-500">Free storage ¬∑ Pay per anchor</p>
                            </div>
                            <a href="/billing.html" class="border border-steel text-steel px-4 py-2 text-xs hover:bg-steel/10 rounded">
                                Manage Balance ‚Üí
                            </a>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-800">
                            <a href="/billing.html" class="text-steel text-xs hover:underline flex items-center justify-between">
                                <span data-i18n="con_billing_link">View detailed billing ‚Üí</span>
                                <span class="text-gray-500" data-i18n="con_billing_desc">balance, history, rates</span>
                            </a>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ===== Â∫ïÈÉ® ===== -->
        <div class="text-center text-xs text-gray-600 pt-10 border-t border-gray-800 mt-12">
            <a href="https://github.com/schchit/hjs-api" class="hover:text-gray-400 mx-2">GitHub</a>
            <span class="text-gray-700">¬∑</span>
            <a href="/spec/README.md" class="hover:text-gray-400 mx-2">Spec</a>
            <span class="text-gray-700">¬∑</span>
            <a href="/cases.html" class="hover:text-gray-400 mx-2">Cases</a>
        </div>
    </div>

    <!-- ===== ÂÖ®Â±ÄËØ≠Ë®ÄÂ±Ç ===== -->
    <script src="/js/lang.js"></script>
    <script>
        // API Âü∫Á°ÄÂú∞ÂùÄ
        const API_BASE = 'https://hjs-api.onrender.com';

        // ===== Áä∂ÊÄÅÁÆ°ÁêÜ =====
        let currentEmail = localStorage.getItem('hjs_console_email') || '';
        let keys = [];
        let logs = [];
        let metrics = {
            total_judgments: 0,
            active_keys: 0,
            monthly_anchors: 0,
            balance: 0
        };

        // ===== DOM ÂÖÉÁ¥† =====
        const emailInput = document.getElementById('email-input');
        const verifyBtn = document.getElementById('verify-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const authStatus = document.getElementById('auth-status');
        const currentEmailSpan = document.getElementById('current-email');
        
        // Ê†áÁ≠æÈ°µ
        const tabKeys = document.getElementById('tab-keys');
        const tabUsage = document.getElementById('tab-usage');
        const panelKeys = document.getElementById('panel-keys');
        const panelUsage = document.getElementById('panel-usage');
        
        // Áî®ÈáèÂÖÉÁ¥†
        const totalJudgments = document.getElementById('total-judgments');
        const activeKeys = document.getElementById('active-keys');
        const monthlyAnchors = document.getElementById('monthly-anchors');
        const monthlyCost = document.getElementById('monthly-cost');
        const balanceAmount = document.getElementById('balance-amount');
        const quotaRemaining = document.getElementById('quota-remaining');
        const quotaBar = document.getElementById('quota-bar');
        
        // ÂàùÂßãÂåñÈÇÆÁÆ±ËæìÂÖ•
        if (currentEmail) {
            emailInput.value = currentEmail;
            emailInput.disabled = true;
            verifyBtn.classList.add('hidden');
            logoutBtn.classList.remove('hidden');
            authStatus.classList.remove('hidden');
            currentEmailSpan.textContent = currentEmail;
            enableAllFeatures();
            loadAllData();
        }

        // ===== Ê†áÁ≠æÈ°µÂàáÊç¢ =====
        tabKeys.addEventListener('click', () => {
            tabKeys.classList.add('active');
            tabUsage.classList.remove('active');
            panelKeys.classList.remove('hidden');
            panelUsage.classList.add('hidden');
        });

        tabUsage.addEventListener('click', () => {
            tabUsage.classList.add('active');
            tabKeys.classList.remove('active');
            panelUsage.classList.remove('hidden');
            panelKeys.classList.add('hidden');
            if (currentEmail) {
                fetchMetrics();
                fetchBalance();
            }
        });

        // ===== ÈÇÆÁÆ±È™åËØÅ =====
        verifyBtn.addEventListener('click', async () => {
            const email = emailInput.value.trim();
            if (!email || !email.includes('@')) return;
            
            verifyBtn.disabled = true;
            verifyBtn.textContent = '...';
            
            await new Promise(r => setTimeout(r, 600));
            
            currentEmail = email;
            localStorage.setItem('hjs_console_email', email);
            
            emailInput.disabled = true;
            verifyBtn.classList.add('hidden');
            logoutBtn.classList.remove('hidden');
            authStatus.classList.remove('hidden');
            currentEmailSpan.textContent = email;
            
            enableAllFeatures();
            loadAllData();
            
            verifyBtn.disabled = false;
            verifyBtn.textContent = 'Verify';
        });

        logoutBtn.addEventListener('click', () => {
            currentEmail = '';
            localStorage.removeItem('hjs_console_email');
            
            emailInput.disabled = false;
            emailInput.value = '';
            verifyBtn.classList.remove('hidden');
            logoutBtn.classList.add('hidden');
            authStatus.classList.add('hidden');
            
            disableAllFeatures();
            clearAllData();
        });

        function enableAllFeatures() {
            document.querySelectorAll('#api-keys-panel input, #api-keys-panel button').forEach(el => {
                if (el.id !== 'verify-btn' && el.id !== 'logout-btn') {
                    el.disabled = false;
                }
            });
        }

        function disableAllFeatures() {
            document.querySelectorAll('#api-keys-panel input, #api-keys-panel button').forEach(el => {
                if (el.id !== 'verify-btn' && el.id !== 'logout-btn') {
                    el.disabled = true;
                }
            });
        }

        function clearAllData() {
            keys = [];
            logs = [];
            metrics = {
                total_judgments: 0,
                active_keys: 0,
                monthly_anchors: 0,
                balance: 0
            };
            renderKeysList();
            renderQuickStats();
            renderLogs();
            updateMetricsDisplay();
        }

        async function loadAllData() {
            await Promise.all([
                fetchKeys(),
                fetchLogs(),
                fetchMetrics(),
                fetchBalance()
            ]);
        }

        async function fetchKeys() {
            if (!currentEmail) return;
            
            try {
                const res = await fetch(`${API_BASE}/developer/keys?email=${encodeURIComponent(currentEmail)}`);
                
                if (res.ok) {
                    const data = await res.json();
                    keys = Array.isArray(data) ? data : [];
                    metrics.active_keys = keys.length;
                } else {
                    keys = [];
                }
            } catch (err) {
                console.error('Fetch keys error:', err);
                keys = [];
            }
            
            renderKeysList();
            renderQuickStats();
            updateMetricsDisplay();
        }

        async function generateKey(name) {
            if (!currentEmail || !name) return;
            
            try {
                const res = await fetch(`${API_BASE}/developer/keys`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: currentEmail, name })
                });
                
                if (res.ok) {
                    const data = await res.json();
                    await fetchKeys();
                    
                    // Show newly generated key with copy button
                    if (data.key) {
                        showNewKeyDialog(data.key, name);
                    }
                }
            } catch (err) {
                console.error('Generate key error:', err);
            }
        }
        
        function showNewKeyDialog(key, name) {
            const shortKey = key.substring(0, 8) + '...' + key.substring(key.length - 8);
            
            const dialog = document.createElement('div');
            dialog.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50';
            dialog.innerHTML = `
                <div class="bg-gray-900 border border-gray-700 p-6 max-w-md w-full mx-4">
                    <h3 class="text-lg font-medium text-white mb-4">API Key Generated</h3>
                    <p class="text-gray-400 text-sm mb-4">Copy this key now. You won't be able to see it again.</p>
                    
                    <div class="bg-gray-800 p-3 rounded mb-4 max-w-full">
                        <div class="text-xs text-gray-500 mb-1">${name}</div>
                        <div class="font-mono text-sm text-teal-400 break-all overflow-x-auto" id="new-key-full">${shortKey}</div>
                        <input type="hidden" id="new-key-value" value="${key}">
                    </div>
                    
                    <div class="flex gap-3">
                        <button id="copy-new-key" class="flex-1 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded text-sm flex items-center justify-center gap-2">
                            <span>üìã</span>
                            <span id="copy-btn-text">Copy Key</span>
                        </button>
                        <button id="close-new-key" class="px-4 py-2 border border-gray-700 hover:border-gray-600 text-gray-300 rounded text-sm">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialog);
            
            dialog.querySelector('#copy-new-key').addEventListener('click', async () => {
                const fullKey = document.getElementById('new-key-value').value;
                try {
                    await navigator.clipboard.writeText(fullKey);
                    document.getElementById('copy-btn-text').textContent = 'Copied!';
                    setTimeout(() => {
                        document.getElementById('copy-btn-text').textContent = 'Copy Key';
                    }, 2000);
                } catch (err) {
                    alert('Copy failed: ' + fullKey);
                }
            });
            
            dialog.querySelector('#close-new-key').addEventListener('click', () => {
                dialog.remove();
            });
            
            dialog.addEventListener('click', (e) => {
                if (e.target === dialog) dialog.remove();
            });
        }

        async function revokeKey(keyId) {
            if (!currentEmail || !keyId) return;
            
            try {
                const res = await fetch(`${API_BASE}/developer/keys/${keyId}?email=${encodeURIComponent(currentEmail)}`, {
                    method: 'DELETE'
                });
                
                if (res.ok) {
                    await fetchKeys();
                }
            } catch (err) {
                console.error('Revoke key error:', err);
            }
        }

        async function fetchLogs() {
            if (!currentEmail) return;
            
            try {
                const res = await fetch(`${API_BASE}/logs?email=${encodeURIComponent(currentEmail)}&limit=10`);
                
                if (res.ok) {
                    const data = await res.json();
                    logs = data.logs || [];
                }
            } catch (err) {
                console.error('Fetch logs error:', err);
                logs = [];
            }
            
            renderLogs();
        }

        async function fetchMetrics() {
            if (!currentEmail) return;
            
            try {
                const res = await fetch(`${API_BASE}/metrics?email=${encodeURIComponent(currentEmail)}`);
                
                if (res.ok) {
                    const data = await res.json();
                    metrics = {
                        total_judgments: data.total_judgments || 0,
                        active_keys: keys.length,
                        monthly_anchors: data.monthly_anchors || 0,
                        balance: data.balance || 0
                    };
                }
            } catch (err) {
                console.error('Fetch metrics error:', err);
            }
            
            updateMetricsDisplay();
            renderQuickStats();
        }

        async function fetchBalance() {
            if (!currentEmail) return;
            
            try {
                const res = await fetch(`${API_BASE}/billing/balance?email=${encodeURIComponent(currentEmail)}`);
                if (res.ok) {
                    const data = await res.json();
                    metrics.balance = data.balance || 0;
                }
            } catch (err) {
                console.error('Fetch balance error:', err);
            }
            updateMetricsDisplay();
        }

        // ===== Êõ¥Êñ∞Áî®ÈáèÊòæÁ§∫ÔºàÂ≠òÂÇ®ÂÖçË¥πÁâàÔºâ =====
        function updateMetricsDisplay() {
            if (totalJudgments) totalJudgments.textContent = metrics.total_judgments;
            if (activeKeys) activeKeys.textContent = metrics.active_keys;
            if (monthlyAnchors) monthlyAnchors.textContent = metrics.monthly_anchors;
            if (balanceAmount) balanceAmount.textContent = `$${metrics.balance.toFixed(2)}`;
            
            // ËÆ°ÁÆóÈ¢Ñ‰º∞ÊàêÊú¨ÔºàÂè™ÁÆóÈîöÂÆöÔºâ
            if (monthlyCost) {
                const cost = metrics.monthly_anchors * 0.03;
                monthlyCost.textContent = `$${cost.toFixed(2)}`;
            }
            
            // Êó†ÈôêÂ≠òÂÇ®ÊèêÁ§∫
            if (quotaRemaining) quotaRemaining.textContent = 'Unlimited storage';
            if (quotaBar) quotaBar.style.width = '0%';
        }

        function renderKeysList() {
            const container = document.getElementById('keys-list');
            
            if (!currentEmail) {
                container.innerHTML = `<div class="text-center text-gray-500 text-sm py-8" data-i18n="con_keys_verify_first">Verify email to load keys</div>`;
                return;
            }
            
            if (keys.length === 0) {
                container.innerHTML = `<div class="text-center text-gray-500 text-sm py-8" data-i18n="con_keys_no_keys">No API keys found</div>`;
                return;
            }
            
            let html = '';
            keys.forEach(k => {
                const maskedKey = k.key && k.key.length > 8 ? 
                    k.key.substring(0, 4) + '...' + k.key.substring(k.key.length - 4) : 
                    k.key || 'N/A';
                
                html += `
                    <div class="border border-gray-800 p-3" data-key-id="${k.key || ''}">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="text-sm font-medium text-white">${k.name || '-'}</div>
                                <div class="font-mono text-xs text-gray-400 mt-1 max-w-[200px] overflow-x-auto">
                                    <span class="key-value hidden break-all">${k.key || ''}</span>
                                    <span class="key-masked">${maskedKey}</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">${k.created_at ? new Date(k.created_at).toLocaleString() : 'N/A'}</div>
                            </div>
                            <div class="flex gap-2 items-center">
                                <button class="copy-key text-gray-400 hover:text-teal-400" title="Copy">üìã</button>
                                <button class="toggle-key text-gray-400 hover:text-white" title="Show/Hide">üëÅÔ∏è</button>
                                <button class="revoke-key text-gray-400 hover:text-red-400" title="Revoke">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            container.querySelectorAll('.toggle-key').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const card = e.target.closest('[data-key-id]');
                    const masked = card.querySelector('.key-masked');
                    const full = card.querySelector('.key-value');
                    
                    if (masked.classList.contains('hidden')) {
                        masked.classList.remove('hidden');
                        full.classList.add('hidden');
                        btn.textContent = 'üëÅÔ∏è';
                    } else {
                        masked.classList.add('hidden');
                        full.classList.remove('hidden');
                        btn.textContent = 'üôà';
                    }
                });
            });
            
            container.querySelectorAll('.copy-key').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const card = e.target.closest('[data-key-id]');
                    const fullKey = card.getAttribute('data-key-id');
                    
                    try {
                        await navigator.clipboard.writeText(fullKey);
                        btn.textContent = '‚úÖ';
                        setTimeout(() => {
                            btn.textContent = 'üìã';
                        }, 2000);
                    } catch (err) {
                        console.error('Copy failed:', err);
                        alert('Copy failed: ' + fullKey);
                    }
                });
            });
            
            container.querySelectorAll('.revoke-key').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const card = e.target.closest('[data-key-id]');
                    const keyId = card.getAttribute('data-key-id');
                    showRevokeDialog(keyId);
                });
            });
        }

        function renderQuickStats() {
            const container = document.getElementById('quick-stats');
            
            if (!currentEmail) {
                container.innerHTML = `<div class="text-center text-gray-500 text-sm py-4" data-i18n="con_stats_verify_first">Verify email to load stats</div>`;
                return;
            }
            
            container.innerHTML = `
                <div class="flex justify-between border-b border-gray-800 pb-2">
                    <span class="text-gray-400">Total Records</span>
                    <span class="text-white font-mono">${metrics.total_judgments}</span>
                </div>
                <div class="flex justify-between border-b border-gray-800 pb-2">
                    <span class="text-gray-400">Active Keys</span>
                    <span class="text-white font-mono">${keys.length}</span>
                </div>
                <div class="flex justify-between border-b border-gray-800 pb-2">
                    <span class="text-gray-400">Monthly Anchors</span>
                    <span class="text-white font-mono">${metrics.monthly_anchors}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Est. Cost</span>
                    <span class="text-white font-mono">$${(metrics.monthly_anchors * 0.03).toFixed(2)}</span>
                </div>
            `;
        }

        function renderLogs() {
            const container = document.getElementById('logs-container');
            
            if (!currentEmail) {
                container.innerHTML = `<div class="text-center text-gray-500 py-2" data-i18n="con_logs_verify_first">Verify email to load logs</div>`;
                return;
            }
            
            if (logs.length === 0) {
                container.innerHTML = `<div class="text-center text-gray-500 py-2" data-i18n="con_logs_no_logs">No recent requests</div>`;
                return;
            }
            
            let html = '';
            logs.forEach(log => {
                const statusClass = log.status >= 200 && log.status < 300 ? 'status-200' : 
                                   log.status >= 400 && log.status < 500 ? 'status-404' : 
                                   log.status >= 500 ? 'status-500' : '';
                
                html += `
                    <div class="flex items-center gap-2 text-xs border-b border-gray-800 pb-1">
                        <span class="text-gray-500">[${new Date(log.time).toLocaleTimeString()}]</span>
                        <span class="text-steel">${log.method}</span>
                        <span class="text-gray-400">${log.path}</span>
                        <span class="${statusClass}">${log.status}</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ===== ‰∫ã‰ª∂ÁªëÂÆö =====
        document.getElementById('generate-key-btn').addEventListener('click', () => {
            const nameInput = document.getElementById('key-name-input');
            const name = nameInput.value.trim();
            if (name) {
                generateKey(name);
                nameInput.value = '';
            }
        });

        document.getElementById('lookup-btn').addEventListener('click', () => {
            const id = document.getElementById('record-id-input').value.trim();
            if (id) {
                window.location.href = `/lookup.html?id=${id}`;
            }
        });

        document.querySelectorAll('.example-id').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('record-id-input').value = btn.getAttribute('data-id');
            });
        });

        function showRevokeDialog(keyId) {
            const dialog = document.createElement('div');
            dialog.className = 'fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50';
            dialog.innerHTML = `
                <div class="w-full max-w-md border border-gray-800 bg-card p-6">
                    <h3 class="text-lg font-semibold text-white mb-2" data-i18n="con_revoke_title">Revoke API Key</h3>
                    <p class="text-sm text-gray-400 mb-4" data-i18n="con_revoke_desc">This action cannot be undone.</p>
                    <div class="bg-gray-800 p-2 rounded mb-4">
                        <code class="text-xs text-gray-400">${keyId.substring(0, 4)}...${keyId.substring(keyId.length - 4)}</code>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button class="cancel-revoke border border-gray-700 px-4 py-2 text-sm text-gray-400 hover:text-white">Cancel</button>
                        <button class="confirm-revoke bg-red-600 px-4 py-2 text-sm text-white hover:bg-red-700">Revoke</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialog);
            
            dialog.querySelector('.cancel-revoke').addEventListener('click', () => {
                document.body.removeChild(dialog);
            });
            
            dialog.querySelector('.confirm-revoke').addEventListener('click', async () => {
                await revokeKey(keyId);
                document.body.removeChild(dialog);
            });
        }

        // ===== ÁøªËØëÂ≠óÂÖ∏ =====
        const translations = {
            en: {
                nav_home: "Home",
                nav_product: "Product",
                nav_developers: "Developers",
                nav_console: "Console",
                nav_lookup: "Lookup",
                nav_billing: "Billing",
                nav_roi: "ROI",
                nav_governance: "Governance",
                con_version_tag: "HJS Responsibility Protocol ¬∑ v1.0 Beta",
                con_title: "Developer Console",
                con_subtitle: "Manage API keys, inspect records, and monitor protocol usage.",
                con_auth_heading: "EMAIL AUTHENTICATION",
                con_auth_verify: "Verify",
                con_auth_logout: "Logout",
                con_auth_current: "Current",
                con_auth_active: "active",
                con_keys_heading: "API KEY MANAGEMENT",
                con_keys_generate: "Generate",
                con_keys_verify_first: "Verify email to load keys",
                con_keys_no_keys: "No API keys found",
                con_lookup_heading: "RECORD LOOKUP",
                con_lookup_button: "Lookup ‚Üí",
                con_lookup_examples: "Examples:",
                con_lookup_note: "Record verification moved to",
                con_stats_heading: "QUICK STATS",
                con_stats_verify_first: "Verify email to load stats",
                con_logs_heading: "RECENT REQUESTS",
                con_logs_verify_first: "Verify email to load logs",
                con_logs_no_logs: "No recent requests",
                con_revoke_title: "Revoke API Key",
                con_revoke_desc: "This action cannot be undone.",
                con_billing_link: "View detailed billing ‚Üí",
                con_billing_desc: "balance, history, rates"
            },
            zh: {
                nav_home: "È¶ñÈ°µ",
                nav_product: "‰∫ßÂìÅ",
                nav_developers: "ÂºÄÂèëËÄÖ",
                nav_console: "ÊéßÂà∂Âè∞",
                nav_lookup: "Êü•ËØ¢",
                nav_billing: "ËÆ°Ë¥π",
                nav_roi: "ROI",
                nav_governance: "Ê≤ªÁêÜ",
                con_version_tag: "HJS Ë¥£‰ªªÂçèËÆÆ ¬∑ v1.0 Beta",
                con_title: "ÂºÄÂèëËÄÖÊéßÂà∂Âè∞",
                con_subtitle: "ÁÆ°ÁêÜ API ÂØÜÈí•„ÄÅÊü•ËØ¢ËÆ∞ÂΩï„ÄÅÁõëÊéß‰ΩøÁî®ÊÉÖÂÜµ„ÄÇ",
                con_auth_heading: "ÈÇÆÁÆ±È™åËØÅ",
                con_auth_verify: "È™åËØÅ",
                con_auth_logout: "ÈÄÄÂá∫",
                con_auth_current: "ÂΩìÂâçÈÇÆÁÆ±",
                con_auth_active: "Â∑≤ÊøÄÊ¥ª",
                con_keys_heading: "API ÂØÜÈí•ÁÆ°ÁêÜ",
                con_keys_generate: "ÁîüÊàê",
                con_keys_verify_first: "È™åËØÅÈÇÆÁÆ±ÂêéÂä†ËΩΩÂØÜÈí•",
                con_keys_no_keys: "ÊöÇÊó†ÂØÜÈí•",
                con_lookup_heading: "ËÆ∞ÂΩïÊü•ËØ¢",
                con_lookup_button: "Êü•ËØ¢ ‚Üí",
                con_lookup_examples: "Á§∫‰æãÔºö",
                con_lookup_note: "ËÆ∞ÂΩïÊü•ËØ¢Â∑≤ÁßªËá≥",
                con_stats_heading: "Âø´ÈÄüÁªüËÆ°",
                con_stats_verify_first: "È™åËØÅÈÇÆÁÆ±ÂêéÂä†ËΩΩÁªüËÆ°",
                con_logs_heading: "ÊúÄËøëËØ∑Ê±Ç",
                con_logs_verify_first: "È™åËØÅÈÇÆÁÆ±ÂêéÂä†ËΩΩÊó•Âøó",
                con_logs_no_logs: "ÊöÇÊó†ËØ∑Ê±ÇËÆ∞ÂΩï",
                con_revoke_title: "ÂêäÈîÄ API ÂØÜÈí•",
                con_revoke_desc: "Ê≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ",
                con_billing_link: "Êü•ÁúãËØ¶ÁªÜËÆ°Ë¥π ‚Üí",
                con_billing_desc: "‰ΩôÈ¢ù„ÄÅÂéÜÂè≤„ÄÅË¥πÁéá"
            }
        };

        function switchLang(lang) {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang] && translations[lang][key]) {
                    el.innerHTML = translations[lang][key];
                }
            });
            const select = document.querySelector('select');
            if (select) select.value = lang;
        }

        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const urlLang = urlParams.get('lang');
            let lang;
            
            if (urlLang) {
                // URLÂèÇÊï∞‰ºòÂÖàÁ∫ßÊúÄÈ´ò
                lang = urlLang;
                localStorage.setItem('hjs_lang', lang);
                // Ê∏ÖÁêÜURLÂèÇÊï∞
                const url = new URL(window.location);
                url.searchParams.delete('lang');
                window.history.replaceState({}, '', url);
            } else if (localStorage.getItem('hjs_lang')) {
                // Áî®Êà∑Â∑≤ÈÄâÊã©ÔºåÂõ∫ÂÆö‰ΩøÁî®
                lang = localStorage.getItem('hjs_lang');
            } else {
                // Á¨¨‰∏ÄÊ¨°ËÆøÈóÆÔºöÊ£ÄÊµãÊµèËßàÂô®ËØ≠Ë®Ä
                const browserLang = navigator.language || navigator.userLanguage;
                lang = browserLang.toLowerCase().startsWith('zh') ? 'zh' : 'en';
                localStorage.setItem('hjs_lang', lang);
            }
            
            switchLang(lang);
        })();
    </script>
</body>
</html>